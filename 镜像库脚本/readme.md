此处脚本需要结合ansible一起运行。
 无标题

# 镜像库脚本

## 需求

1. 停机，避免窗口期新数据变更。
2. 获取源库my.cnf配置文件，将其复制到镜像库my.cnf
3. 镜像库配置文件开启binlog、初始化。
4. 获取源库数据库名称、在镜像库上批量建库。
5. 源库dump数据结构，scp到镜像库。
6. 镜像库还原dump数据。
7. 源库dump数据，scp到镜像库。
8. 镜像库还原dump数据。

## 伪代码

1. 源：检查是否开启binlog，没有则开启

2. 需要考虑：源库开启binlog是在dump开始之前，还是在dump开启之后。

3. 源：复制my.cnf文件到镜像库。

4. 镜：执行安装、初始化命令

5. 源：本机上获取数据库列表，通过scp文件形式将信息复制到镜像库。

6. 此处可以考虑在镜像库上远程访问源数据库，在镜像库上执行dump、获取数据库名称等操作。

7. 镜：检查数据库库、结构、文件目录大小。

8. 镜：dump还原数据库文件。

9. 镜：再次检查库、结构、文件目录大小。

